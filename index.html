<!DOCTYPE html>
<html>
<head>
    <title>Napi beosztás</title>
    <script>
        let scheduleData = {};
        const sheetID = "1_51aHTZbSH2WIA4Pa59kkl5ukgnAZpCPitBz96lQdeI"; // Google Sheets azonosító
        const apiURL = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json`;
        
        function fetchScheduleData() {
            fetch(apiURL)
                .then(response => response.text())
                .then(data => {
                    console.log("Google Sheets válasz:", data); // Debug log
                    let json = JSON.parse(data.substring(47, data.length - 2));
                    scheduleData = processSheetData(json.table.rows);
                    console.log("Feldolgozott adatok:", scheduleData); // Ellenőrzéshez
                    populateNameDropdown();
                })
                .catch(error => console.error('Hiba az adatok lekérésekor:', error));
        }
        
        function processSheetData(rows) {
            let data = {};
            let dates = rows[0].c.slice(1).map(cell => formatDate(cell?.v));
            console.log("Dátumok:", dates);
            
            for (let i = 1; i < rows.length; i++) {
                let name = rows[i].c[0]?.v;
                console.log("Feldolgozott név:", name);
                if (!name) continue;
                
                data[name] = {};
                for (let j = 1; j < rows[i].c.length; j++) {
                    let date = dates[j - 1];
                    let shift = rows[i].c[j]?.v || "";
                    if (date && shift) {
                        data[name][date] = shift;
                    }
                }
            }
            return data;
        }
        
        function formatDate(serial) {
            if (!serial) return "";
            let date = new Date(Math.round((serial - 25569) * 86400 * 1000));
            let formattedDate = date.toISOString().split('T')[0];
            console.log("Átalakított dátum:", formattedDate);
            return formattedDate;
        }
        
        function populateNameDropdown() {
            let select = document.getElementById("nameSelect");
            select.innerHTML = '<option value="">--Válassz--</option>';
            
            let names = Object.keys(scheduleData);
            console.log("Legördülő menü nevei:", names);
            
            if (names.length === 0) {
                console.error("Nincs elérhető név az adatokban.");
            }
            
            names.forEach(name => {
                let option = document.createElement("option");
                option.value = name;
                option.textContent = name;
                select.appendChild(option);
            });
        }
        
        function updateSchedule() {
            let name = document.getElementById("nameSelect").value;
            let date = document.getElementById("dateSelect").value;
            
            console.log("Kiválasztott név:", name);
            console.log("Kiválasztott dátum:", date);
            console.log("Lekért adat:", scheduleData[name]?.[date]);
            
            if (scheduleData[name] && scheduleData[name][date]) {
                document.getElementById("scheduleOutput").textContent = "Beosztás: " + scheduleData[name][date];
            } else {
                document.getElementById("scheduleOutput").textContent = "Nincs adat erre a napra.";
            }
        }
        
        window.onload = fetchScheduleData;
    </script>
</head>
<body>
    <h2>Válaszd ki a neved:</h2>
    <select id="nameSelect" onchange="updateSchedule()">
        <option value="">--Válassz--</option>
    </select>
    
    <h2>Válassz dátumot:</h2>
    <input type="date" id="dateSelect" onchange="updateSchedule()">
    
    <p id="scheduleOutput">Beosztás:</p>
</body>
</html>
